generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  directUrl         = env("DIRECT_URL")
}


enum UserRole {
  student
  faculty
}

enum PublishType {
  private
  organisation
  public
}

enum TestType {
  quiz
  coding
  summary
}

model User {
  id           String   @id @default(uuid()) @map("id")
  name         String   @map("name")
  phoneNo      String?  @map("phone_no")
  email        String   @unique @map("email")
  university   String?  @map("university")
  collegeName  String?  @map("college_name")
  role         UserRole @map("role")
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  createdExams     Exam[]           @relation("created_exams")
  studentResponses Response[]       @relation("student_responses")
  facultyResponses Response[]       @relation("faculty_responses")
  assignedTo       ExamAssignment[] @relation("assigned_to")
  assignedBy       ExamAssignment[] @relation("assigned_by")
  facultyChannels  Channel[]        @relation("faculty_channels")

  @@map("users")
}

model Channel {
  id          String   @id @default(uuid()) @map("id")
  name        String   @map("name")
  description String?  @map("description")
  facultyId   String?  @map("faculty_id")
  teamMembers String[] @map("team_members")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  faculty User? @relation("faculty_channels", fields: [facultyId], references: [id])
  exams   Exam[]

  @@map("channels")
}

model Exam {
  id              String      @id @default(uuid()) @map("id")
  name            String      @map("name")
  domain          String?     @map("domain")
  questionCount   Int?        @map("question_count")
  durationMinutes Int?        @map("duration_minutes")
  questions       Json        @map("questions")
  testType        TestType    @map("test_type")
  publishType     PublishType @map("publish_type")
  organization    String?     @map("organization")
  instructions    String?     @map("instructions")
  createdAt       DateTime    @default(now()) @map("created_at")
  updatedAt       DateTime    @updatedAt @map("updated_at")

  createdById String? @map("created_by_id")
  channelId   String? @map("channel_id")

  createdBy   User?            @relation("created_exams", fields: [createdById], references: [id])
  channel     Channel?         @relation(fields: [channelId], references: [id])
  responses   Response[]
  assignments ExamAssignment[]

  @@map("exams")
}

model Response {
  id            String   @id @default(uuid()) @map("id")
  response      Json     @map("response")
  responseScore Float?   @map("response_score")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  examId    String  @map("exam_id")
  studentId String? @map("student_id")
  facultyId String? @map("faculty_id")

  exam    Exam  @relation(fields: [examId], references: [id], onDelete: Cascade)
  student User? @relation("student_responses", fields: [studentId], references: [id])
  faculty User? @relation("faculty_responses", fields: [facultyId], references: [id])

  @@map("responses")
}

model ExamAssignment {
  id           String   @id @default(uuid()) @map("id")
  assignedAt   DateTime @default(now()) @map("assigned_at")

  examId       String @map("exam_id")
  assignedToId String @map("assigned_to_id")
  assignedById String @map("assigned_by_id")

  exam       Exam @relation(fields: [examId], references: [id], onDelete: Cascade)
  assignedTo User @relation("assigned_to", fields: [assignedToId], references: [id])
  assignedBy User @relation("assigned_by", fields: [assignedById], references: [id])

  @@map("exam_assignments")
}
